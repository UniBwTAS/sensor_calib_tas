<launch>

  <!-- Load board config -->
  <rosparam command="load" file="$(find extrinsic_sensor_calib)/config/board_config.yaml" ns="sensor_calib/board_config"/>

  <!-- AprilTag detectors -->
  <include file="$(find extrinsic_sensor_calib)/launch/camera_apriltag_detection.launch">
    <arg name="name" value="surround_front"/>
    <arg name="topic" value="/sensor/camera/surround/front"/>
    <arg name="color_mode" value="rect_color"/>
  </include>
  <include file="$(find extrinsic_sensor_calib)/launch/camera_apriltag_detection.launch">
    <arg name="name" value="surround_right"/>
    <arg name="topic" value="/sensor/camera/surround/right"/>
    <arg name="color_mode" value="color"/>
  </include>

  <!-- LiDAR hole detector -->
  <include file="$(find extrinsic_sensor_calib)/launch/lidar_hole_pattern_detection.launch">
    <arg name="name" value="vls128"/>
    <arg name="topic" value="/sensor/lidar/vls128_roof/velodyne_points"/>
    <arg name="min_x" value="5"/>
    <arg name="max_x" value="20"/>
    <arg name="min_y" value="-10"/>
    <arg name="max_y" value="10"/>
    <arg name="min_z" value="-2"/>
    <arg name="max_z" value="3"/>
  </include>

  <!-- Radar target detector -->
  <include file="$(find extrinsic_sensor_calib)/launch/radar_doppler_simulator_detection.launch">
    <arg name="name" value="umrr"/>
    <arg name="topic" value="/sensor/radar/umrr/detections"/>
  </include>

  <!-- Calibration node -->
  <!-- When using rosrun or when starting from IDE append __ns:=sensor_calib ~board_config/boards:=/sensor_calib/board_config/boards -->
  <node pkg="extrinsic_sensor_calib" type="extrinsic_sensor_calib" name="extrinsic_sensor_calib" ns="sensor_calib" output="screen">
    <remap from="~board_config/boards" to="/sensor_calib/board_config/boards"/>
    <rosparam>
      reference_frame: sensor/lidar/vls128_roof
      lidars:
          - {frame_id: sensor/lidar/vls128_roof, detector_topic: /sensor_calib/hole_pattern_detector_vls128/detections, sigma: 0.01}
      cameras:
          - {frame_id: sensor/camera/surround/front, detector_topic: /sensor_calib/apriltag_detector_surround_front/detections, rectified: true, sigma: 0.2}
          - {frame_id: sensor/camera/surround/right, detector_topic: /sensor_calib/apriltag_detector_surround_right/detections, rectified: false, sigma: 0.2}
      radars:
          - {frame_id: sensor/radar/umrr/32, detector_topic: /sensor_calib/doppler_simulator_detector_umrr/umrr/32, sigma_range: 0.1, sigma_azimuth: 0.5, sigma_elevation: 9}
          - {frame_id: sensor/radar/umrr/35, detector_topic: /sensor_calib/doppler_simulator_detector_umrr/umrr/35, sigma_range: 0.1, sigma_azimuth: 0.5, sigma_elevation: 9}
    </rosparam>
  </node>

  <!-- Visualization -->
  <node type="rviz" name="rviz" pkg="rviz" args="-d $(find extrinsic_sensor_calib)/config/extrinsic_sensor_calib.rviz" ns="sensor_calib"/>
  <node type="rqt_gui" name="rqt_gui" pkg="rqt_gui" args="--perspective-file $(find extrinsic_sensor_calib)/config/extrinsic_sensor_calib.perspective" ns="sensor_calib"/>

</launch>
