<launch>

  <!-- Load board config -->
  <rosparam command="load" file="$(find extrinsic_sensor_calib)/config/board_config.yaml"
            ns="sensor_calib/board_config"/>

  <!-- Cameras -->
  <include file="$(find extrinsic_sensor_calib)/launch/camera_apriltag_detection.launch">
    <arg name="name" value="marveye_left"/>
    <arg name="topic" value="/sensor/camera/marveye/left"/>
    <arg name="color_mode" value="rect_color"/>
  </include>

  <!-- LiDAR -->
  <include file="$(find extrinsic_sensor_calib)/launch/lidar_hole_pattern_detection.launch">
    <arg name="name" value="vls128"/>
    <arg name="topic" value="/sensor/lidar/vls128_roof/velodyne_points"/>
    <arg name="min_x" value="5"/>
    <arg name="max_x" value="20"/>
    <arg name="min_y" value="-10"/>
    <arg name="max_y" value="10"/>
    <arg name="min_z" value="-2"/>
    <arg name="max_z" value="3"/>
  </include>

  <!-- Calibration Node -->
  <!-- When using rosrun or when starting from IDE append __ns:=sensor_calib ~board_config/boards:=/sensor_calib/board_config/boards -->
  <node pkg="extrinsic_sensor_calib" type="extrinsic_sensor_calib" name="extrinsic_sensor_calib" ns="sensor_calib"
        output="screen">
    <remap from="~board_config/boards" to="/sensor_calib/board_config/boards"/>
    <rosparam>
      reference_frame: sensor/lidar/vls128_roof
      lidars:
      - {frame_id: sensor/lidar/vls128_roof, detector_topic: /sensor_calib/hole_pattern_detector_vls128/detections, sigma: 0.01}
      cameras:
      - {frame_id: sensor/camera/marveye/left, detector_topic: /sensor_calib/apriltag_detector_marveye_left/detections, sigma: 0.2}
      radars:
      []
    </rosparam>
  </node>

  <!-- Visualization -->
  <node type="rviz" name="rviz_camera_calib" pkg="rviz"
        args="-d $(find extrinsic_sensor_calib)/config/extrinsic_sensor_calib.rviz"/>
  <node type="rqt_gui" name="rqt_gui" pkg="rqt_gui"
        args="--perspective-file $(find extrinsic_sensor_calib)/config/sensor_calib.perspective" ns="sensor_calib"/>

</launch>
